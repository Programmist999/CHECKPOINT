<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHECKPOINT</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
        :root {
            --bg: #050505;
            --accent: #00ff41; /* –ù–µ–æ–Ω–æ–≤–æ-–∑–µ–ª–µ–Ω—ã–π */
            --accent-glow: rgba(0, 255, 65, 0.5);
            --text: #ffffff;
            --sub-text: #888;
            --grid: rgba(0, 255, 65, 0.05);
            --panel-bg: rgba(255, 255, 255, 0.03);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        [data-theme="light"] {
            --bg: #f0f0f0;
            --accent: #2ecc71;
            --accent-glow: rgba(46, 204, 113, 0.3);
            --text: #1a1a1a;
            --sub-text: #555;
            --grid: rgba(0, 0, 0, 0.05);
            --panel-bg: rgba(0, 0, 0, 0.05);
        }

        /* –û–°–ù–û–í–ù–û–ô –°–¢–ò–õ–¨ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; cursor:crosshair; }
        body { background-color: var(--bg); color: var(--text); overflow: hidden; height: 100vh; transition: background 0.8s ease; }
        
        /* CRT –≠–§–§–ï–ö–¢ (—É–ª—É—á—à–µ–Ω–Ω—ã–π) */
        body::before {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05));
            z-index: 1000; background-size: 100% 3px, 3px 100%; pointer-events: none; opacity: 0.8;
        }

        .btn {
            background: var(--bg);
            border: 2px outset var(--text);
            color: var(--text);
            padding: 8px 15px;
            font-family: 'Press Start 2P';
            font-size: 0.6rem;
            cursor: pointer;
            text-shadow: 0 0 5px var(--accent);
            box-shadow: 0 0 5px var(--accent-glow);
            transition: all 0.05s linear; /* –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ */
            margin: 5px;
        }

        .btn:active {
            border: 2px inset var(--accent);
            background: var(--accent);
            color: var(--bg);
            box-shadow: 0 0 10px var(--accent-glow);
            transform: translateY(1px);
        }

        .btn-lang-them {
            background: var(--bg);
            border: 2px outset var(--text);
            color: var(--text);
            padding: 8px 15px;
            font-family: 'Press Start 2P';
            font-size: 0.6rem;
            cursor: pointer;
            text-shadow: 0 0 5px var(--accent);
            box-shadow: 0 0 5px var(--accent-glow);
            transition: all 0.05s linear; /* –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ */
            margin: 5px;
            align-items: center;
            justify-content: center;
            position: relative;
            left: 1670px;
            margin-top: -15px;
        }

        .btn-lang-them:active {
            border: 2px inset var(--accent);
            background: var(--accent);
            color: var(--bg);
            box-shadow: 0 0 10px var(--accent-glow);
            transform: translateY(1px);
        }

        /* –°–ï–¢–ö–ê (Grid) */
        .grid-layer {
            position: fixed; width: 200%; height: 200%; background-image: linear-gradient(var(--grid) 1px, transparent 1px), 
                              linear-gradient(90deg, var(--grid) 1px, transparent 1px);
            background-size: 40px 40px; z-index: -1; transform: rotate(15deg); animation: gridMove 60s linear infinite;
        }
        @keyframes gridMove {
            from { transform: rotate(15deg) translate(0, 0); }
            to { transform: rotate(15deg) translate(-1000px, -1000px); }
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-sidebar { position: fixed; left: 30px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 20px; z-index: 100; }
        .nav-item { width: 14px; height: 14px; border: 2px solid var(--accent); border-radius: 3px; transition: var(--transition); position: relative; }
        .nav-item::after { content: attr(data-label); position: absolute; left: 30px; top: -2px; font-size: 10px; opacity: 0; white-space: nowrap; color: var(--accent); text-transform: uppercase; font-family: 'Press Start 2P'; }
        .nav-item:hover::after, .nav-item.active::after { opacity: 1; }
        .nav-item.active { background: var(--accent); box-shadow: 0 0 15px var(--accent); transform: scale(1.2) rotate(45deg); }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† –°–ï–ö–¶–ò–ô */
        main { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        section { display: none; width: 80%; max-width: 1200px; animation: slideIn 0.8s cubic-bezier(0.19, 1, 0.22, 1); text-align: center; }
        section.active { display: block; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); filter: blur(10px); }
            to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }

        /* –ó–ê–ì–û–õ–û–í–ö–ò –ò –®–†–ò–§–¢–´ */
        h1 { font-family: 'Press Start 2P', cursive; font-size: 3.5rem; margin-bottom: 20px; color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }
        .pixel-label { font-family: 'Press Start 2P'; font-size: 0.7rem; letter-spacing: 2px; color: var(--sub-text); margin-bottom: 40px; margin-top: 25px;}
        .big-text { font-size: 4rem; font-family: 'Press Start 2P'; color: var(--text); margin: 20px 0; }
        .big-text.small { font-size: 1.5rem; }

        /* –ö–ê–†–¢–û–ß–ö–ò –ò –ì–†–ò–î–´ */
        .widget-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--panel-bg); border: 1px solid var(--grid); padding: 25px; border-radius: 8px; backdrop-filter: blur(10px); transition: var(--transition); text-align: left; }
        .card:hover { border-color: var(--accent); transform: translateY(-5px); background: rgba(255, 255, 255, 0.05); }

        /* –≠–õ–ï–ú–ï–ù–¢–´ –§–û–†–ú–´ */
        input, select {
            background: none; border: 1px solid var(--accent); color: var(--text); padding: 8px; margin: 5px;
            font-family: 'JetBrains Mono'; font-size: 1rem; transition: var(--transition);
        }
        input:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow); }

        /* –î–ò–ó–ê–ô–ù –°–ï–ö–£–ù–î–û–ú–ï–†–ê */
        #sw-display { font-size: 2.5rem; text-align: center; margin-bottom: 10px; }
        #laps-list { max-height: 150px; overflow-y: auto; list-style: none; margin-top: 10px; padding-right: 10px; }
        #laps-list li { border-bottom: 1px solid var(--grid); padding: 5px 0; font-size: 0.9rem; display: flex; justify-content: space-between; }

        /* –î–ò–ó–ê–ô–ù –í–†–ï–ú–ï–ù–ò */
        .world-time-grid { grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .world-time-card p:first-child { font-family: 'Press Start 2P'; font-size: 0.6rem; color: var(--accent); }

        /* –î–ò–ó–ê–ô–ù –§–ò–ù–ê–ù–°–û–í */
        .rate-value { font-size: 1.8rem; font-weight: bold; margin-top: 5px; }
        .rate-change { font-size: 0.9rem; }
        .rate-change.up { color: #00ff00; }
        .rate-change.down { color: #ff0000; }

        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 15px 30px;
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        /* –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        #news-feed::-webkit-scrollbar {
            width: 6px;
        }

        #news-feed::-webkit-scrollbar-track {
            background: var(--panel-bg);
        }

        #news-feed::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .top-bar, .bottom-bar {
                padding: 10px 15px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .world-time-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* –°–¢–ò–õ–ò –ü–û–ò–°–ö–ê –ò –§–ò–õ–¨–¢–†–û–í */
        .search-container {
            animation: slideIn 0.5s ease;
        }

        .filter-btn, .weather-filter-btn {
            background: var(--panel-bg);
            border: 1px solid var(--grid);
            color: var(--text);
            padding: 6px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            cursor: pointer;
            border-radius: 4px;
            transition: var(--transition);
        }

        .filter-btn:hover, .weather-filter-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .filter-btn.active, .weather-filter-btn.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
        }

        /* –°–ï–¢–ö–ê –î–õ–Ø –ë–û–õ–¨–®–û–ì–û –ö–û–õ–ò–ß–ï–°–¢–í–ê –≠–õ–ï–ú–ï–ù–¢–û–í */
        .world-time-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) !important;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }

        /* –°–ö–†–û–õ–õ–ë–ê–†–´ */
        .world-time-grid::-webkit-scrollbar,
        #rates-container::-webkit-scrollbar,
        #weather-container::-webkit-scrollbar {
            width: 8px;
        }

        .world-time-grid::-webkit-scrollbar-track,
        #rates-container::-webkit-scrollbar-track,
        #weather-container::-webkit-scrollbar-track {
            background: rgba(0, 255, 65, 0.05);
            border-radius: 4px;
        }

        .world-time-grid::-webkit-scrollbar-thumb,
        #rates-container::-webkit-scrollbar-thumb,
        #weather-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        /* –ö–ê–†–¢–û–ß–ö–ò –° –ê–ù–ò–ú–ê–¶–ò–ï–ô */
        .rate-card, .weather-card, .time-card {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* –ò–ù–î–ò–ö–ê–¢–û–†–´ –ü–û–ò–°–ö–ê */
        .search-info {
            font-size: 0.8rem;
            color: var(--sub-text);
            padding: 10px;
            text-align: center;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body data-theme="dark">

    <div class="grid-layer"></div>

    <div class="top-bar">
        <div id="top-time" class="pixel-label" style="margin-bottom: 0;">00:00:00</div>
        <div>
            <button class="btn-lang-them btn" onclick="toggleLang()">LANG: RU</button>
            <button class="btn-lang-them" onclick="toggleTheme()">THEME</button>
        </div>
    </div>

    <nav class="nav-sidebar">
        <div class="nav-item active" data-target="home" data-label="Home"></div>
        <div class="nav-item" data-target="clock" data-label="World Time"></div>
        <div class="nav-item" data-target="tools" data-label="Tools"></div>
        <div class="nav-item" data-target="finance" data-label="Market"></div>
        <div class="nav-item" data-target="weather" data-label="Meteo"></div>
        <div class="nav-item" data-target="news" data-label="News Feed"></div>
    </nav>

    <main>
        <section id="home" class="active">
            <h1 id="t-welcome">CHECKPOINT</h1>
            <p class="pixel-label" id="t-subtitle">–°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ï–†–°–ò–Ø 2.0</p>
            <div class="widget-grid">
                <div class="card" style="text-align: center;">
                    <p id="t-stats" class="pixel-label" style="margin-bottom: 5px;">–°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´</p>
                    <p style="color: var(--accent); font-size: 2rem;">ONLINE</p>
                </div>
                <div class="card" style="text-align: center;">
                    <p id="t-loc" class="pixel-label" style="margin-bottom: 5px;">–ú–û–Ø –õ–û–ö–ê–¶–ò–Ø</p>
                    <p id="geo-city" style="color: var(--accent); font-size: 2rem;">–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï...</p>
                </div>
            </div>
            <button class="btn" style="margin-top: 50px;" onclick="switchTab('clock')" id="t-start">–ò–ù–ò–¶–ò–ò–†–û–í–ê–¢–¨</button>
        </section>

        <section id="clock">
            <h1 id="t-world-h">–ú–ò–†–û–í–û–ï –í–†–ï–ú–Ø</h1>
            <p class="pixel-label" id="t-local-time">–ú–ï–°–¢–ù–û–ï –í–†–ï–ú–Ø</p>
            <div class="big-text" id="main-clock">00:00:00</div>

            <!-- –ü–û–ò–°–ö –î–û–ë–ê–í–õ–Ø–ï–ú –ó–î–ï–°–¨ -->
            <div class="search-container" style="margin: 20px auto; max-width: 600px;">
                <input type="text" id="time-search" 
                    placeholder="–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞..." 
                    style="width: 100%; padding: 12px; background: var(--panel-bg); border: 1px solid var(--accent); color: var(--text);">
                <div style="font-size: 0.7rem; color: var(--sub-text); margin-top: 5px;">
                    üîç –ò—Å–∫–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –∫–æ–¥—É —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
                </div>
            </div>
            
            <p class="pixel-label" id="t-world-list">–í–†–ï–ú–Ø –í –ö–õ–Æ–ß–ï–í–´–• –¢–û–ß–ö–ê–•</p>
            <div class="widget-grid world-time-grid" id="world-time-container">
                </div>
        </section>

        <section id="tools">
            <h1 id="t-tools-h">–ò–ù–°–¢–†–£–ú–ï–ù–¢–´</h1>
            <div class="widget-grid">
                <div class="card">
                    <p id="t-sw" class="pixel-label">–°–ï–ö–£–ù–î–û–ú–ï–† PRO</p>
                    <div id="sw-display">00:00:00.00</div>
                    <button class="btn" onclick="stopwatch.toggle()" id="sw-btn">START</button>
                    <button class="btn" onclick="stopwatch.lap()" id="sw-lap-btn">–ö–†–£–ì</button>
                    <button class="btn" onclick="stopwatch.reset()">–°–ë–†–û–°</button>
                    <ul id="laps-list"></ul>
                </div>

                <div class="card">
                    <p id="t-tm" class="pixel-label">–ù–ê–°–¢–†–ê–ò–í–ê–ï–ú–´–ô –¢–ê–ô–ú–ï–†</p>
                    <div id="tm-display" class="big-text small" style="margin: 5px 0;">00:00:00:00</div>
                    <div style="display: flex; justify-content: space-around; margin-bottom: 15px;">
                        <input type="number" id="tm-days" min="0" value="0" placeholder="–î–Ω–∏" style="width: 70px;">
                        <input type="number" id="tm-hours" min="0" max="23" value="0" placeholder="–ß–∞—Å—ã" style="width: 70px;">
                        <input type="number" id="tm-mins" min="0" max="59" value="5" placeholder="–ú–∏–Ω" style="width: 70px;">
                        <input type="number" id="tm-secs" min="0" max="59" value="0" placeholder="–°–µ–∫" style="width: 70px;">
                    </div>
                    <button class="btn" onclick="timer.start()" id="tm-btn">–°–¢–ê–†–¢</button>
                    <button class="btn" onclick="timer.pause()">–ü–ê–£–ó–ê</button>
                    <button class="btn" onclick="timer.reset()">–°–ë–†–û–°</button>
                </div>
            </div>
        </section>

        <section id="finance">
            <h1 id="t-fin-h">–ì–õ–û–ë–ê–õ–¨–ù–´–ï –†–´–ù–ö–ò</h1>
            <p class="pixel-label" id="t-fin-sub">–ê–ö–¶–ò–ò, –ö–†–ò–ü–¢–û–í–ê–õ–Æ–¢–´ –ò –°–´–†–¨–ï –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò</p>

            <!-- –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–´ -->
            <div class="search-container" style="margin: 20px auto; max-width: 800px;">
                <input type="text" id="finance-search" 
                    placeholder="–ü–æ–∏—Å–∫: BTC, AAPL, EUR/USD, –∑–æ–ª–æ—Ç–æ..." 
                    style="width: 100%; padding: 12px; background: var(--panel-bg); border: 1px solid var(--accent); color: var(--text);">
                
                <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                    <button class="filter-btn active" data-filter="all">–í–°–ï</button>
                    <button class="filter-btn" data-filter="crypto">–ö–†–ò–ü–¢–û</button>
                    <button class="filter-btn" data-filter="stock">–ê–ö–¶–ò–ò</button>
                    <button class="filter-btn" data-filter="forex">–í–ê–õ–Æ–¢–´</button>
                    <button class="filter-btn" data-filter="commodity">–°–´–†–¨–ï</button>
                    <button class="filter-btn" data-filter="index">–ò–ù–î–ï–ö–°–´</button>
                </div>
            </div>

            <div class="widget-grid" id="rates-container">
                </div>
        </section>

        <section id="weather">
            <h1 id="t-weather-h">–ú–ï–¢–ï–û–¶–ï–ù–¢–†</h1>
            <p class="pixel-label" id="t-weather-sub">–ü–û–ì–û–î–ê –í –û–°–ù–û–í–ù–´–• –ú–ï–ì–ê–ü–û–õ–ò–°–ê–•</p>

            <!-- –ü–û–ò–°–ö –ú–ï–¢–ï–û -->
            <div class="search-container" style="margin: 20px auto; max-width: 600px;">
                <input type="text" id="weather-search" 
                    placeholder="–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ —Å—Ç—Ä–∞–Ω—ã..." 
                    style="width: 100%; padding: 12px; background: var(--panel-bg); border: 1px solid var(--accent); color: var(--text);">
                
                <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                    <button class="weather-filter-btn active" data-weather-filter="all">–í–°–ï</button>
                    <button class="weather-filter-btn" data-weather-filter="sunny">‚òÄÔ∏è –°–æ–ª–Ω–µ—á–Ω–æ</button>
                    <button class="weather-filter-btn" data-weather-filter="cloudy">‚òÅÔ∏è –û–±–ª–∞—á–Ω–æ</button>
                    <button class="weather-filter-btn" data-weather-filter="rainy">üåßÔ∏è –î–æ–∂–¥—å</button>
                    <button class="weather-filter-btn" data-weather-filter="snowy">‚ùÑÔ∏è –°–Ω–µ–≥</button>
                    <button class="weather-filter-btn" data-weather-filter="stormy">‚õàÔ∏è –ì—Ä–æ–∑–∞</button>
                </div>
            </div>

            <div class="widget-grid" id="weather-container">
                </div>
        </section>

        <section id="news">
            <h1 id="t-news-h">–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ô –ü–û–¢–û–ö</h1>
            <p class="pixel-label" id="t-news-sub">–ê–ö–¢–£–ê–õ–¨–ù–´–ï –ú–ò–†–û–í–´–ï –ù–û–í–û–°–¢–ò</p>
            <div id="news-feed" style="text-align: left; max-height: 400px; overflow-y: auto; padding: 10px;">
                </div>
        </section>
    </main>

    <div class="bottom-bar">
        <div id="music-visualizer">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
        <button class="btn" onclick="audioPlayer.toggle()" id="t-music">PLAY MUSIC</button>
    </div>

    <audio id="bg-audio" loop src="./2b52b40e2a3d9f6.mp3"></audio>

    <script>
        // --- –î–ê–ù–ù–´–ï –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–ò ---
        const i18n = {
            ru: {
                welcome: "CHECKPOINT", subtitle: "–°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ï–†–°–ò–Ø 2.0", start: "–ò–ù–ò–¶–ò–ò–†–û–í–ê–¢–¨",
                stats: "–°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´", loc: "–ú–û–Ø –õ–û–ö–ê–¶–ò–Ø", world_h: "–ú–ò–†–û–í–û–ï –í–†–ï–ú–Ø",
                local_time: "–ú–ï–°–¢–ù–û–ï –í–†–ï–ú–Ø", world_list: "–í–†–ï–ú–Ø –í –ö–õ–Æ–ß–ï–í–´–• –¢–û–ß–ö–ê–•",
                tools_h: "–ò–ù–°–¢–†–£–ú–ï–ù–¢–´", sw: "–°–ï–ö–£–ù–î–û–ú–ï–† PRO", tm: "–ù–ê–°–¢–†–ê–ò–í–ê–ï–ú–´–ô –¢–ê–ô–ú–ï–†",
                fin_h: "–ì–õ–û–ë–ê–õ–¨–ù–´–ï –†–´–ù–ö–ò", fin_sub: "–ê–ö–¶–ò–ò, –ö–†–ò–ü–¢–û–í–ê–õ–Æ–¢–´ –ò –°–´–†–¨–ï –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò",
                weather_h: "–ú–ï–¢–ï–û–¶–ï–ù–¢–†", weather_sub: "–ü–û–ì–û–î–ê –í –û–°–ù–û–í–ù–´–• –ú–ï–ì–ê–ü–û–õ–ò–°–ê–•",
                news_h: "–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ô –ü–û–¢–û–ö", news_sub: "–ê–ö–¢–£–ê–õ–¨–ù–´–ï –ú–ò–†–û–í–´–ï –ù–û–í–û–°–¢–ò",
                music: "PLAY MUSIC",
                time_search: "–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞...",
                time_search_hint: "üîç –ò—Å–∫–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –∫–æ–¥—É —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞",
                finance_search: "–ü–æ–∏—Å–∫: BTC, AAPL, EUR/USD, –∑–æ–ª–æ—Ç–æ...",
                weather_search: "–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ —Å—Ç—Ä–∞–Ω—ã...",
                filter_all: "–í–°–ï",
                filter_crypto: "–ö–†–ò–ü–¢–û",
                filter_stock: "–ê–ö–¶–ò–ò",
                filter_forex: "–í–ê–õ–Æ–¢–´",
                filter_commodity: "–°–´–†–¨–ï",
                filter_index: "–ò–ù–î–ï–ö–°–´",
                weather_filter_all: "–í–°–ï",
                weather_filter_sunny: "‚òÄÔ∏è –°–æ–ª–Ω–µ—á–Ω–æ",
                weather_filter_cloudy: "‚òÅÔ∏è –û–±–ª–∞—á–Ω–æ",
                weather_filter_rainy: "üåßÔ∏è –î–æ–∂–¥—å",
                weather_filter_snowy: "‚ùÑÔ∏è –°–Ω–µ–≥",
                weather_filter_stormy: "‚õàÔ∏è –ì—Ä–æ–∑–∞"
            },
            en: {
                welcome: "CHECKPOINT", subtitle: "CONTROL SYSTEM VERSION 2.0", start: "INITIATE",
                stats: "SYSTEM STATUS", loc: "MY LOCATION", world_h: "WORLD CLOCK",
                local_time: "LOCAL TIME", world_list: "KEY ZONE TIMES",
                tools_h: "TOOLS", sw: "STOPWATCH PRO", tm: "CUSTOM TIMER",
                fin_h: "GLOBAL MARKETS", fin_sub: "STOCKS, CRYPTO & COMMODITIES IN REAL-TIME",
                weather_h: "METEO CENTER", weather_sub: "WEATHER IN MAJOR CITIES",
                news_h: "INFORMATION FEED", news_sub: "CURRENT WORLD NEWS",
                music: "PLAY MUSIC",
                time_search: "Search city or timezone...",
                time_search_hint: "üîç Search by city name or timezone code",
                finance_search: "Search: BTC, AAPL, EUR/USD, gold...",
                weather_search: "Search city or country...",
                filter_all: "ALL",
                filter_crypto: "CRYPTO",
                filter_stock: "STOCKS",
                filter_forex: "FOREX",
                filter_commodity: "COMMODITIES",
                filter_index: "INDEXES",
                weather_filter_all: "ALL",
                weather_filter_sunny: "‚òÄÔ∏è Sunny",
                weather_filter_cloudy: "‚òÅÔ∏è Cloudy",
                weather_filter_rainy: "üåßÔ∏è Rainy",
                weather_filter_snowy: "‚ùÑÔ∏è Snowy",
                weather_filter_stormy: "‚õàÔ∏è Stormy"
            }
        };

        let currentLang = 'ru';

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª —Å 'time' –Ω–∞ 'clock') ---
        function switchTab(id) {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelector(`[data-target="${id}"]`).classList.add('active');
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => switchTab(item.dataset.target));
        });

        // --- –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function applyLocalization() {
            const langData = i18n[currentLang];
            document.getElementById('t-welcome').innerText = langData.welcome;
            document.getElementById('t-subtitle').innerText = langData.subtitle;
            document.getElementById('t-start').innerText = langData.start;
            document.getElementById('t-stats').innerText = langData.stats;
            document.getElementById('t-loc').innerText = langData.loc;
            document.getElementById('t-world-h').innerText = langData.world_h;
            document.getElementById('t-local-time').innerText = langData.local_time;
            document.getElementById('t-world-list').innerText = langData.world_list;
            document.getElementById('t-tools-h').innerText = langData.tools_h;
            document.getElementById('t-sw').innerText = langData.sw;
            document.getElementById('t-tm').innerText = langData.tm;
            document.getElementById('t-fin-h').innerText = langData.fin_h;
            document.getElementById('t-fin-sub').innerText = langData.fin_sub;
            document.getElementById('t-weather-h').innerText = langData.weather_h;
            document.getElementById('t-weather-sub').innerText = langData.weather_sub;
            document.getElementById('t-news-h').innerText = langData.news_h;
            document.getElementById('t-news-sub').innerText = langData.news_sub;
            document.getElementById('t-music').innerText = langData.music;

            document.querySelector('.top-bar .btn:first-child').innerText = `LANG: ${currentLang.toUpperCase()}`;
            // –ù–æ–≤—ã–µ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞
            const timeSearch = document.getElementById('time-search');
            const financeSearch = document.getElementById('finance-search');
            const weatherSearch = document.getElementById('weather-search');
            
            if (timeSearch) timeSearch.placeholder = langData.time_search;
            if (financeSearch) financeSearch.placeholder = langData.finance_search;
            if (weatherSearch) weatherSearch.placeholder = langData.weather_search;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
            const timeHint = document.querySelector('#time-search + div');
            if (timeHint) timeHint.innerHTML = langData.time_search_hint;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const filter = btn.dataset.filter;
                if (langData[`filter_${filter}`]) {
                    btn.textContent = langData[`filter_${filter}`];
                }
            });
            
            document.querySelectorAll('.weather-filter-btn').forEach(btn => {
                const filter = btn.dataset.weatherFilter;
                if (langData[`weather_filter_${filter}`]) {
                    btn.textContent = langData[`weather_filter_${filter}`];
                }
            });
        }

        function toggleLang() {
            currentLang = currentLang === 'ru' ? 'en' : 'ru';
            applyLocalization();
        }
        applyLocalization();

        // --- –ß–ê–°–´ –ò –ú–ò–†–û–í–û–ï –í–†–ï–ú–Ø (API) ---
        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            document.getElementById('main-clock').innerText = timeStr;
            document.getElementById('top-time').innerText = timeStr;
        }
        setInterval(updateClock, 1000);

        // --- –ú–ò–†–û–í–û–ï –í–†–ï–ú–Ø (–û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù - 6 –≥–æ—Ä–æ–¥–æ–≤) ---
        async function updateWorldTime() {
            const container = document.getElementById('world-time-container');
            if (!container) return;
            
            const cities = [
                { name: '–ú–û–°–ö–í–ê', tz: 'Europe/Moscow', apiName: 'Europe/Moscow' },
                { name: '–õ–û–ù–î–û–ù', tz: 'Europe/London', apiName: 'Europe/London' },
                { name: '–ù–¨–Æ –ô–û–†–ö', tz: 'America/New_York', apiName: 'America/New_York' },
                { name: '–¢–û–ö–ò–û', tz: 'Asia/Tokyo', apiName: 'Asia/Tokyo' },
                { name: '–°–ò–î–ù–ï–ô', tz: 'Australia/Sydney', apiName: 'Australia/Sydney' },
                { name: '–ü–ï–ö–ò–ù', tz: 'Asia/Shanghai', apiName: 'Asia/Shanghai' }
            ];
            
            container.innerHTML = '<div class="search-info">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...</div>';
            
            let html = '';
            let loaded = 0;
            
            for (const city of cities) {
                try {
                    // –ü–†–û–ë–£–ï–ú –ü–ï–†–í–´–ô API: timezonedb.com (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§)
                    let timeStr = '';
                    let offsetStr = '';
                    
                    try {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è timezonedb.com

                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://worldtimeapi.org/api/timezone/${city.apiName}`)}`;
                        // const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(`http://api.timezonedb.com/v2.1/get-time-zone?key=87HQH2WMAOI3&format=json&by=zone&zone=${city.apiName}`)}`;
                        // const proxyUrl = `https://smartapp-code.sberdevices.ru/tools/api/now?tz=${city.apiName}`
                        // –í–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º (–¥–ª—è —Ç–µ—Å—Ç–∞)
                        // const response = await fetch(`https://api.timezonedb.com/v2.1/get-time-zone?key=87HQH2WMAOI3&format=json&by=zone&zone=${city.apiName}`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.status === 'OK') {
                                const date = new Date(data.formatted);
                                timeStr = date.toLocaleTimeString('ru-RU', {
                                    hour12: false,
                                    hour: '2-digit',
                                    minute: '2-digit',
                                    second: '2-digit'
                                });
                                offsetStr = `UTC${data.gmtOffset >= 0 ? '+' : ''}${data.gmtOffset / 3600}`;
                            }
                        }
                    } catch (e) { /* –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª */ }
                    
                    // –ï–°–õ–ò –ü–ï–†–í–´–ô API –ù–ï –°–†–ê–ë–û–¢–ê–õ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –∫–∞–∫ fallback
                    if (!timeStr) {
                        timeStr = new Date().toLocaleTimeString('ru-RU', {
                            timeZone: city.tz,
                            hour12: false,
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        offsetStr = city.tz;
                    }
                    
                    html += `
                        <div class="card world-time-card">
                            <p class="pixel-label">${city.name}</p>
                            <p class="big-text small" style="margin: 5px 0; color: var(--accent);">${timeStr}</p>
                            <p style="font-size: 0.7rem; color: var(--sub-text);">${offsetStr}</p>
                        </div>
                    `;
                    
                    loaded++;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ –º–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏
                    if (loaded % 2 === 0) {
                        container.innerHTML = html;
                    }
                    
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è ${city.name}:`, error);
                    // –ï—Å–ª–∏ —Å–æ–≤—Å–µ–º –≤—Å—ë —É–ø–∞–ª–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–æ—Ç—è –±—ã –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
                    html += `
                        <div class="card world-time-card">
                            <p class="pixel-label">${city.name}</p>
                            <p style="color: var(--sub-text); font-size: 0.9rem;">–í—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>
                        </div>
                    `;
                }
            }
            
            container.innerHTML = html;
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        updateWorldTime();
        setInterval(updateWorldTime, 1000);


        // –í–ö–õ–ê–î–ö–ê "–§–ò–ù–ê–ù–°–´" - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô API
        async function setupFinanceSearch() {
            const searchInput = document.getElementById('finance-search');
            const container = document.getElementById('rates-container');
            
            if (!searchInput || !container) return;
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ API (—Ä–∞–±–æ—Ç–∞—é—Ç –≤ –†–§, –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∫–ª—é—á–∞)
            const APIs = {
                // –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã - CoinGecko (–æ—Å–Ω–æ–≤–Ω–æ–π) + Binance (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
                crypto: [
                    'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1',
                    'https://api.binance.com/api/v3/ticker/24hr'
                ],
                // –í–∞–ª—é—Ç—ã - –¶–ë –†–§ + Open Exchange Rates (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
                forex: [
                    'https://www.cbr-xml-daily.ru/daily_json.js',
                    'https://open.er-api.com/v6/latest/USD'
                ]
            };
            
            let financeData = [];
            let loading = false;
            
            // –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ß–ò–°–ï–õ –ö–ê–ö –ù–ê –°–ö–†–ò–ù–®–û–¢–ï ($2,03 –≤–º–µ—Å—Ç–æ $2.03)
            function formatPrice(price) {
                if (typeof price !== 'number') return price;
                
                // –î–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ü–µ–Ω (–º–µ–Ω—å—à–µ 1$) –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª—å—à–µ –∑–Ω–∞–∫–æ–≤
                if (price < 1) {
                    return price.toFixed(price < 0.01 ? 6 : 4);
                }
                // –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Ü–µ–Ω (1-1000$) –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 2 –∑–Ω–∞–∫–∞
                else if (price < 1000) {
                    return price.toLocaleString('ru-RU', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }
                // –î–ª—è –±–æ–ª—å—à–∏—Ö —Ü–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–∑ –∫–æ–ø–µ–µ–∫
                else {
                    return price.toLocaleString('ru-RU', {
                        maximumFractionDigits: 0
                    });
                }
            }
            
            // –ü–û–õ–£–ß–ï–ù–ò–ï –¶–í–ï–¢–ê –î–õ–Ø –ò–ö–û–ù–û–ö –ö–†–ò–ü–¢–û
            function getCryptoColor(symbol) {
                const colors = {
                    'BTC': '#f7931a',    // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                    'ETH': '#627eea',    // –°–∏–Ω–∏–π
                    'XRP': '#00aae4',    // –ì–æ–ª—É–±–æ–π
                    'SOL': '#00ffa3',    // –ù–µ–æ–Ω–æ–≤–æ-–∑–µ–ª–µ–Ω—ã–π
                    'ADA': '#0033ad',    // –°–∏–Ω–∏–π
                    'DOGE': '#c2a633',   // –ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π
                    'DOT': '#e6007a',    // –†–æ–∑–æ–≤—ã–π
                    'BNB': '#f0b90b',    // –ñ–µ–ª—Ç—ã–π
                    'USDT': '#26a17b',   // –ó–µ–ª–µ–Ω—ã–π
                    'USDC': '#2775ca',   // –°–∏–Ω–∏–π
                    'LINK': '#2a5ada',   // –°–∏–Ω–∏–π
                    'LTC': '#bfbbbb',    // –°–µ—Ä–µ–±—Ä—è–Ω—ã–π
                    'AVAX': '#e84142',   // –ö—Ä–∞—Å–Ω—ã–π
                    'XLM': '#000000',    // –ß–µ—Ä–Ω—ã–π
                    'ATOM': '#2e3148',   // –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π
                    'FIL': '#0090ff',    // –ì–æ–ª—É–±–æ–π
                    'ALGO': '#000000',    // –ß–µ—Ä–Ω—ã–π
                    'VET': '#15bdff',    // –ì–æ–ª—É–±–æ–π
                    'TRX': '#ff060a',    // –ö—Ä–∞—Å–Ω—ã–π
                    'ETC': '#328332'     // –ó–µ–ª–µ–Ω—ã–π
                };
                return colors[symbol.toUpperCase()] || '#00ff41';
            }
            
            // –ó–ê–ì–†–£–ó–ö–ê –ö–†–ò–ü–¢–û–í–ê–õ–Æ–¢
            async function loadCryptocurrencies() {
                try {
                    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç...');
                    
                    // –ü—Ä–æ–±—É–µ–º CoinGecko (–æ—Å–Ω–æ–≤–Ω–æ–π)
                    try {
                        const response = await fetch(APIs.crypto[0]);
                        if (!response.ok) throw new Error('CoinGecko –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                        
                        const data = await response.json();
                        
                        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                        data.forEach(coin => {
                            financeData.push({
                                id: coin.id,
                                symbol: coin.symbol.toUpperCase(),
                                name: coin.name,
                                type: 'crypto',
                                price: `$${formatPrice(coin.current_price)}`,
                                priceNum: coin.current_price,
                                change: coin.price_change_percentage_24h,
                                isUp: coin.price_change_percentage_24h >= 0,
                                color: getCryptoColor(coin.symbol),
                                marketCap: coin.market_cap,
                                volume: coin.total_volume
                            });
                        });
                        
                        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.length} –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏–∑ CoinGecko`);
                        return;
                    } catch (error) {
                        console.warn('CoinGecko –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±—É–µ–º Binance...', error);
                    }
                    
                    // –ü—Ä–æ–±—É–µ–º Binance (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
                    try {
                        const response = await fetch(APIs.crypto[1]);
                        const data = await response.json();
                        
                        // –¢–æ–ø –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –ø–æ –æ–±—ä–µ–º—É
                        const topCryptos = data
                            .filter(ticker => ticker.symbol.endsWith('USDT'))
                            .sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume))
                            .slice(0, 50);
                        
                        topCryptos.forEach(ticker => {
                            const symbol = ticker.symbol.replace('USDT', '');
                            const price = parseFloat(ticker.lastPrice);
                            const change = parseFloat(ticker.priceChangePercent);
                            
                            financeData.push({
                                id: symbol.toLowerCase(),
                                symbol: symbol,
                                name: getCryptoName(symbol),
                                type: 'crypto',
                                price: `$${formatPrice(price)}`,
                                priceNum: price,
                                change: change,
                                isUp: change >= 0,
                                color: getCryptoColor(symbol),
                                marketCap: 0,
                                volume: parseFloat(ticker.quoteVolume)
                            });
                        });
                        
                        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${topCryptos.length} –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏–∑ Binance`);
                    } catch (error) {
                        console.error('–û–±–∞ API –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', error);
                        // Fallback –¥–∞–Ω–Ω—ã–µ
                        loadFallbackCryptos();
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç:', error);
                    loadFallbackCryptos();
                }
            }
            
            // –ü–û–õ–£–ß–ï–ù–ò–ï –ù–ê–ó–í–ê–ù–ò–Ø –ö–†–ò–ü–¢–û–í–ê–õ–Æ–¢–´ –ü–û –°–ò–ú–í–û–õ–£
            function getCryptoName(symbol) {
                const names = {
                    'BTC': 'Bitcoin',
                    'ETH': 'Ethereum',
                    'BNB': 'Binance Coin',
                    'XRP': 'Ripple',
                    'SOL': 'Solana',
                    'ADA': 'Cardano',
                    'DOGE': 'Dogecoin',
                    'DOT': 'Polkadot',
                    'TRX': 'TRON',
                    'LINK': 'Chainlink',
                    'MATIC': 'Polygon',
                    'LTC': 'Litecoin',
                    'UNI': 'Uniswap',
                    'AVAX': 'Avalanche',
                    'XLM': 'Stellar',
                    'ATOM': 'Cosmos',
                    'ALGO': 'Algorand',
                    'VET': 'VeChain',
                    'FIL': 'Filecoin',
                    'ETC': 'Ethereum Classic',
                    'XTZ': 'Tezos',
                    'EOS': 'EOS',
                    'AAVE': 'Aave',
                    'MKR': 'Maker',
                    'COMP': 'Compound',
                    'YFI': 'yearn.finance',
                    'SNX': 'Synthetix',
                    'SUSHI': 'SushiSwap',
                    'CRV': 'Curve DAO Token',
                    'ZEC': 'Zcash',
                    'DASH': 'Dash',
                    'NEO': 'NEO',
                    'WAVES': 'Waves',
                    'QTUM': 'Qtum',
                    'ICX': 'ICON',
                    'OMG': 'OMG Network',
                    'ZIL': 'Zilliqa',
                    'BAT': 'Basic Attention Token',
                    'ONT': 'Ontology',
                    'IOST': 'IOST',
                    'CELR': 'Celer Network',
                    'ONE': 'Harmony',
                    'CHZ': 'Chiliz',
                    'ENJ': 'Enjin Coin',
                    'ANKR': 'Ankr',
                    'STMX': 'StormX',
                    'DENT': 'Dent',
                    'HOT': 'Holo',
                    'WRX': 'WazirX',
                    'FTM': 'Fantom',
                    'KAVA': 'Kava',
                    'AR': 'Arweave',
                    'REN': 'Ren',
                    'RSR': 'Reserve Rights',
                    'CVC': 'Civic',
                    'STORJ': 'Storj',
                    'DATA': 'Streamr',
                    'BAND': 'Band Protocol',
                    'OCEAN': 'Ocean Protocol',
                    'NKN': 'NKN',
                    'LTO': 'LTO Network',
                    'TOMO': 'TomoChain',
                    'PERL': 'Perlin',
                    'DUSK': 'Dusk Network',
                    'KEY': 'SelfKey',
                    'IQ': 'Everipedia',
                    'PNT': 'pNetwork',
                    'DREP': 'Drep',
                    'TLM': 'Alien Worlds',
                    'SLP': 'Smooth Love Potion',
                    'CHR': 'Chromia',
                    'MDX': 'Mdex',
                    'ATA': 'Automata',
                    'DOCK': 'Dock',
                    'WAN': 'Wanchain',
                    'WTC': 'Waltonchain',
                    'ITC': 'IoT Chain',
                    'GTO': 'Gifto',
                    'ARN': 'Aeron',
                    'AGI': 'SingularityNET',
                    'BLZ': 'Bluzelle',
                    'REP': 'Augur',
                    'BTS': 'BitShares',
                    'LOOM': 'Loom Network',
                    'MANA': 'Decentraland',
                    'SAND': 'The Sandbox',
                    'AXS': 'Axie Infinity',
                    'GALA': 'Gala',
                    'YGG': 'Yield Guild Games',
                    'ILV': 'Illuvium',
                    'RNDR': 'Render Token',
                    'AUDIO': 'Audius',
                    'API3': 'API3',
                    'GRT': 'The Graph',
                    'UMA': 'UMA',
                    'BADGER': 'Badger DAO',
                    'POND': 'Marlin',
                    'MIR': 'Mirror Protocol',
                    'ORC': 'Orchid',
                    'RLC': 'iExec RLC',
                    'PHA': 'Phala Network',
                    'KSM': 'Kusama',
                    'DIA': 'DIA',
                    'BEL': 'Bella Protocol',
                    'SFP': 'SafePal',
                    'XVS': 'Venus',
                    'CAKE': 'PancakeSwap',
                    'BAKE': 'BakeryToken',
                    'BURGER': 'Burger Swap',
                    'ALPHA': 'Alpha Finance Lab',
                    'INJ': 'Injective Protocol',
                    'CTK': 'CertiK',
                    'HARD': 'HARD Protocol',
                    'FOR': 'ForTube',
                    'TWT': 'Trust Wallet Token',
                    'EPS': 'Ellipsis',
                    'AUTO': 'Auto',
                    'LINA': 'Linear',
                    'CFX': 'Conflux',
                    'AKRO': 'Akropolis',
                    'COTI': 'COTI',
                    'DODO': 'DODO',
                    'LIT': 'Litentry',
                    'REEF': 'Reef',
                    'TVK': 'Terra Virtua Kolect',
                    'FIS': 'StaFi',
                    'PUNDIX': 'Pundi X',
                    'PSG': 'Paris Saint-Germain Fan Token',
                    'CITY': 'Manchester City Fan Token',
                    'OG': 'OG Fan Token',
                    'ASR': 'AS Roma Fan Token',
                    'ATM': 'Atletico Madrid Fan Token',
                    'BAR': 'FC Barcelona Fan Token',
                    'JUV': 'Juventus Fan Token',
                    'ACM': 'AC Milan Fan Token',
                    'GAL': 'Galatasaray Fan Token',
                    'TRA': 'Trabzonspor Fan Token',
                    'NAP': 'Napoli Fan Token',
                    'VAI': 'Vai',
                    'XEM': 'NEM',
                    'SC': 'Siacoin',
                    'ZEN': 'Horizen',
                    'XVG': 'Verge',
                    'BCD': 'Bitcoin Diamond',
                    'SXP': 'Swipe',
                    'CHSB': 'SwissBorg',
                    'CND': 'Cindicator',
                    'GVT': 'Genesis Vision',
                    'MTL': 'Metal',
                    'NULS': 'NULS',
                    'POA': 'POA Network',
                    'POWR': 'Power Ledger',
                    'RDN': 'Raiden Network',
                    'REQ': 'Request',
                    'SNT': 'Status',
                    'STORM': 'Storm',
                    'SUB': 'Substratum',
                    'SYS': 'Syscoin',
                    'VIA': 'Viacoin',
                    'VIB': 'Viberate',
                    'WPR': 'WePower',
                    'ZRX': '0x'
                };
                return names[symbol] || symbol;
            }
            
            // FALLBACK –î–ê–ù–ù–´–ï
            function loadFallbackCryptos() {
                const fallbackData = [
                    { symbol: 'BTC', name: 'Bitcoin', price: '$68,450.23', change: 2.34, isUp: true },
                    { symbol: 'ETH', name: 'Ethereum', price: '$3,520.67', change: 1.78, isUp: true },
                    { symbol: 'BNB', name: 'Binance Coin', price: '$585.42', change: -0.45, isUp: false },
                    { symbol: 'SOL', name: 'Solana', price: '$185.39', change: 5.21, isUp: true },
                    { symbol: 'XRP', name: 'Ripple', price: '$0.6234', change: -1.23, isUp: false },
                    { symbol: 'ADA', name: 'Cardano', price: '$0.4812', change: -0.89, isUp: false },
                    { symbol: 'AVAX', name: 'Avalanche', price: '$42.15', change: 3.45, isUp: true },
                    { symbol: 'DOGE', name: 'Dogecoin', price: '$0.1523', change: 0.67, isUp: true },
                    { symbol: 'DOT', name: 'Polkadot', price: '$8.34', change: -2.15, isUp: false },
                    { symbol: 'MATIC', name: 'Polygon', price: '$1.023', change: 1.23, isUp: true }
                ];
                
                fallbackData.forEach(coin => {
                    financeData.push({
                        id: coin.symbol.toLowerCase(),
                        symbol: coin.symbol,
                        name: coin.name,
                        type: 'crypto',
                        price: coin.price,
                        priceNum: parseFloat(coin.price.replace('$', '').replace(',', '')),
                        change: coin.change,
                        isUp: coin.isUp,
                        color: getCryptoColor(coin.symbol),
                        marketCap: 0,
                        volume: 0
                    });
                });
            }
            
            // –ó–ê–ì–†–£–ó–ö–ê –í–ê–õ–Æ–¢
            async function loadForex() {
                try {
                    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–ª—é—Ç...');
                    
                    // –ü—Ä–æ–±—É–µ–º –¶–ë –†–§
                    try {
                        const response = await fetch(APIs.forex[0]);
                        if (!response.ok) throw new Error('–¶–ë –†–§ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                        
                        const data = await response.json();
                        
                        // –û—Å–Ω–æ–≤–Ω—ã–µ –≤–∞–ª—é—Ç—ã
                        const mainCurrencies = ['USD', 'EUR', 'CNY', 'GBP', 'JPY', 'CHF', 'TRY', 'KZT'];
                        
                        mainCurrencies.forEach(code => {
                            if (data.Valute[code]) {
                                const currency = data.Valute[code];
                                const change = ((currency.Value - currency.Previous) / currency.Previous * 100);
                                
                                financeData.push({
                                    id: code.toLowerCase(),
                                    symbol: code,
                                    name: currency.Name,
                                    type: 'forex',
                                    price: `${formatPrice(currency.Value)} ‚ÇΩ`,
                                    priceNum: currency.Value,
                                    change: change,
                                    isUp: change >= 0,
                                    color: code === 'USD' ? '#00ff41' : 
                                        code === 'EUR' ? '#0033cc' : 
                                        code === 'CNY' ? '#de2910' : '#888888'
                                });
                            }
                        });
                        
                        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${mainCurrencies.length} –≤–∞–ª—é—Ç –∏–∑ –¶–ë –†–§`);
                        return;
                    } catch (error) {
                        console.warn('–¶–ë –†–§ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±—É–µ–º Open Exchange Rates...', error);
                    }
                    
                    // –ü—Ä–æ–±—É–µ–º Open Exchange Rates
                    try {
                        const response = await fetch(APIs.forex[1]);
                        const data = await response.json();
                        
                        const rates = data.rates;
                        const mainPairs = {
                            'EUR/USD': rates.EUR,
                            'GBP/USD': rates.GBP,
                            'JPY/USD': rates.JPY,
                            'CAD/USD': rates.CAD,
                            'AUD/USD': rates.AUD,
                            'CHF/USD': rates.CHF
                        };
                        
                        Object.entries(mainPairs).forEach(([pair, rate]) => {
                            const [from, to] = pair.split('/');
                            financeData.push({
                                id: pair.toLowerCase().replace('/', '_'),
                                symbol: pair,
                                name: `${from} –∫ ${to}`,
                                type: 'forex',
                                price: rate.toFixed(4),
                                priceNum: rate,
                                change: 0,
                                isUp: true,
                                color: '#888888'
                            });
                        });
                        
                    } catch (error) {
                        console.error('–û–±–∞ API –≤–∞–ª—é—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', error);
                        loadFallbackForex();
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞–ª—é—Ç:', error);
                    loadFallbackForex();
                }
            }
            
            function loadFallbackForex() {
                const fallbackCurrencies = [
                    { symbol: 'USD/RUB', name: '–î–æ–ª–ª–∞—Ä –°–®–ê', price: '92.45 ‚ÇΩ', change: 0.23, isUp: true },
                    { symbol: 'EUR/RUB', name: '–ï–≤—Ä–æ', price: '99.80 ‚ÇΩ', change: -0.12, isUp: false },
                    { symbol: 'CNY/RUB', name: '–ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å', price: '12.75 ‚ÇΩ', change: 0.34, isUp: true }
                ];
                
                fallbackCurrencies.forEach(currency => {
                    financeData.push({
                        id: currency.symbol.toLowerCase().replace('/', '_'),
                        symbol: currency.symbol,
                        name: currency.name,
                        type: 'forex',
                        price: currency.price,
                        priceNum: parseFloat(currency.price),
                        change: currency.change,
                        isUp: currency.isUp,
                        color: currency.symbol === 'USD/RUB' ? '#00ff41' : '#888888'
                    });
                });
            }
            
            // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ê–ù–ù–´–•
            function displayFinanceData(data) {
                container.innerHTML = '';
                
                if (data.length === 0) {
                    container.innerHTML = `
                        <div class="search-info" style="grid-column: 1 / -1;">
                            üîç –ê–∫—Ç–∏–≤–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                        </div>
                    `;
                    return;
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä—ã–Ω–æ—á–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –∫—Ä–∏–ø—Ç–æ) –∏–ª–∏ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
                const sortedData = [...data].sort((a, b) => {
                    if (a.type === 'crypto' && b.type === 'crypto') {
                        return (b.marketCap || 0) - (a.marketCap || 0);
                    }
                    return a.type === 'crypto' ? -1 : 1;
                });
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º
                sortedData.forEach(item => {
                    const changeValue = Math.abs(item.change).toFixed(2);
                    const changeSign = item.isUp ? '+' : '-';
                    
                    container.innerHTML += `
                        <div class="card rate-card" style="min-height: 140px; animation: fadeIn 0.3s ease;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span class="pixel-label" style="font-size: 0.9rem; color: ${item.color};">
                                    ${item.symbol}
                                </span>
                                <span style="font-size: 0.7rem; padding: 2px 6px; background: var(--panel-bg); border-radius: 3px;">
                                    ${item.type === 'crypto' ? '–ö–†–ò–ü–¢–û' : '–í–ê–õ–Æ–¢–ê'}
                                </span>
                            </div>
                            
                            <div class="rate-value" style="color: ${item.color}; font-size: 1.8rem; font-weight: bold; margin: 10px 0;">
                                ${item.price}
                            </div>
                            
                            <div style="font-size: 0.9rem; color: var(--sub-text); margin-bottom: 8px;">
                                ${item.name}
                            </div>
                            
                            <div class="rate-change ${item.isUp ? 'up' : 'down'}" style="margin-top: auto;">
                                ${item.isUp ? '‚Üó' : '‚Üò'} ${changeSign}${changeValue}%
                            </div>
                            
                            ${item.volume ? `
                            <div style="font-size: 0.7rem; color: var(--sub-text); margin-top: 5px;">
                                –û–±—ä–µ–º: $${(item.volume / 1000000).toFixed(1)}M
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                container.innerHTML += `
                    <div class="search-info" style="grid-column: 1 / -1; text-align: center; padding: 10px;">
                        üìä –ü–æ–∫–∞–∑–∞–Ω–æ ${sortedData.length} –∞–∫—Ç–∏–≤–æ–≤ | 
                        –ö—Ä–∏–ø—Ç–æ: ${sortedData.filter(d => d.type === 'crypto').length} | 
                        –í–∞–ª—é—Ç—ã: ${sortedData.filter(d => d.type === 'forex').length}
                    </div>
                `;
            }
            
            // –§–ò–õ–¨–¢–†–ê–¶–ò–Ø
            function filterFinanceData(query = '', filter = 'all') {
                let filtered = financeData;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
                if (filter !== 'all') {
                    filtered = filtered.filter(item => item.type === filter);
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                if (query) {
                    const q = query.toLowerCase();
                    filtered = filtered.filter(item => 
                        item.symbol.toLowerCase().includes(q) ||
                        item.name.toLowerCase().includes(q) ||
                        item.id.toLowerCase().includes(q)
                    );
                }
                
                return filtered;
            }
            
            // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.trim();
                const filter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                const filtered = filterFinanceData(query, filter);
                displayFinanceData(filtered);
            });
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.dataset.filter;
                    const query = searchInput.value.trim();
                    const filtered = filterFinanceData(query, filter);
                    displayFinanceData(filtered);
                });
            });
            
            // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
            async function init() {
                if (loading) return;
                loading = true;
                
                container.innerHTML = `
                    <div class="search-info" style="grid-column: 1 / -1; text-align: center; padding: 20px;">
                        <div style="margin-bottom: 10px;">üìà –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...</div>
                        <div style="font-size: 0.8rem; color: var(--sub-text);">
                            –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏ –≤–∞–ª—é—Ç
                        </div>
                    </div>
                `;
                
                try {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∫—Ä–∏–ø—Ç–æ –∏ –≤–∞–ª—é—Ç—ã
                    await Promise.all([
                        loadCryptocurrencies(),
                        loadForex()
                    ]);
                    
                    console.log('–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∞–∫—Ç–∏–≤–æ–≤:', financeData.length);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    displayFinanceData(financeData);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤:', error);
                    displayFinanceData([]);
                } finally {
                    loading = false;
                }
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
            init();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                if (!document.getElementById('finance').classList.contains('active')) return;
                
                console.log('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
                financeData = [];
                init();
            }, 60000);
        }

        // --- –ü–û–ò–°–ö –ì–û–†–û–î–û–í –í –ú–ò–†–û–í–û–ú –í–†–ï–ú–ï–ù–ò (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô) ---
        async function setupTimeSearch() {
            const searchInput = document.getElementById('time-search');
            const container = document.getElementById('world-time-container');
            
            if (!searchInput || !container) return;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Ç–∞–π–º–∑–æ–Ω—ã - –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç API
            const allTimezones = Intl.supportedValuesOf('timeZone');
            console.log(`–î–æ—Å—Ç—É–ø–Ω–æ —Ç–∞–π–º–∑–æ–Ω: ${allTimezones.length}`);
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
            const timezoneData = allTimezones.map(tz => {
                const parts = tz.split('/');
                const city = parts[parts.length - 1].replace(/_/g, ' ');
                const region = parts.length > 1 ? parts[0] : 'Global';
                
                return {
                    id: tz,
                    city: city,
                    region: region,
                    fullName: tz,
                    searchText: `${city} ${region} ${tz}`.toLowerCase()
                };
            });
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤ (–±–µ–∑ API –∑–∞–ø—Ä–æ—Å–æ–≤ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è)
            function displayCities(filteredCities, isSearch = false) {
                container.innerHTML = '';
                
                if (filteredCities.length === 0) {
                    container.innerHTML = `
                        <div class="search-info">
                            üïê –ì–æ—Ä–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å
                        </div>
                    `;
                    return;
                }
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const citiesToShow = isSearch ? filteredCities.slice(0, 30) : filteredCities.slice(0, 12);
                
                citiesToShow.forEach(item => {
                    try {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è - –æ–Ω–æ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ
                        const time = new Date().toLocaleTimeString('ru-RU', {
                            timeZone: item.id,
                            hour12: false,
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        
                        const date = new Date().toLocaleDateString('ru-RU', {
                            timeZone: item.id,
                            weekday: 'short',
                            day: 'numeric',
                            month: 'short'
                        });
                        
                        container.innerHTML += `
                            <div class="card world-time-card" style="min-height: 120px;">
                                <p class="pixel-label" style="margin-bottom: 5px; font-size: 0.8rem;">
                                    üåç ${item.city.toUpperCase()}
                                </p>
                                <p class="big-text small" style="margin: 5px 0; color: var(--accent);">
                                    ${time}
                                </p>
                                <p style="font-size: 0.7rem; color: var(--sub-text);">
                                    üìç ${item.region}<br>
                                    <span style="font-size: 0.6rem;">${date}</span>
                                </p>
                            </div>
                        `;
                    } catch (e) {
                        // –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–π–º–∑–æ–Ω—É
                        container.innerHTML += `
                            <div class="card world-time-card">
                                <p class="pixel-label">${item.city.toUpperCase()}</p>
                                <p style="color: var(--sub-text);">–¢–∞–π–º–∑–æ–Ω–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>
                            </div>
                        `;
                    }
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (isSearch) {
                    container.innerHTML += `
                        <div class="search-info" style="grid-column: 1 / -1;">
                            üåê –ù–∞–π–¥–µ–Ω–æ: ${filteredCities.length} —Ç–∞–π–º–∑–æ–Ω | –ü–æ–∫–∞–∑–∞–Ω–æ: ${citiesToShow.length}
                        </div>
                    `;
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const popularTimezones = [
                'Europe/Moscow', 'Europe/London', 'America/New_York',
                'Asia/Tokyo', 'Australia/Sydney', 'Europe/Paris',
                'Asia/Dubai', 'Asia/Shanghai', 'America/Los_Angeles'
            ];
            
            const popularCities = timezoneData.filter(tz => 
                popularTimezones.includes(tz.id)
            );
            
            displayCities(popularCities.length > 0 ? popularCities : timezoneData.slice(0, 12));
            
            // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    displayCities(popularCities.length > 0 ? popularCities : timezoneData.slice(0, 12));
                    return;
                }
                
                const filtered = timezoneData.filter(tz => 
                    tz.searchText.includes(query) ||
                    tz.city.toLowerCase().includes(query) ||
                    tz.region.toLowerCase().includes(query)
                );
                
                displayCities(filtered, true);
            });
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤–∏–¥–∏–º—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(() => {
                const currentQuery = searchInput.value.trim();
                if (currentQuery) {
                    const filtered = timezoneData.filter(tz => 
                        tz.searchText.includes(currentQuery.toLowerCase())
                    );
                    if (filtered.length > 0) {
                        displayCities(filtered, true);
                    }
                }
            }, 60000);
        }

        // --- –ú–ï–¢–ï–û–¶–ï–ù–¢–† (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô - —Å —Ä–∞–±–æ—Ç–∞—é—â–∏–º API) ---
        async function setupWeatherSearch() {
            const searchInput = document.getElementById('weather-search');
            const container = document.getElementById('weather-container');
            
            if (!searchInput || !container) return;
            
            // –ù–û–í–´–ô API –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§
            const WEATHER_API = 'https://api.open-meteo.com/v1/forecast';
            
            // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (—á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞)
            const popularCities = [
                { name: '–ú–æ—Å–∫–≤–∞', lat: 55.7558, lon: 37.6173, country: '–†–æ—Å—Å–∏—è' },
                { name: '–õ–æ–Ω–¥–æ–Ω', lat: 51.5074, lon: -0.1278, country: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è' },
                { name: '–¢–æ–∫–∏–æ', lat: 35.6762, lon: 139.6503, country: '–Ø–ø–æ–Ω–∏—è' },
                { name: '–ù—å—é-–ô–æ—Ä–∫', lat: 40.7128, lon: -74.0060, country: '–°–®–ê' },
                { name: '–ü–∞—Ä–∏–∂', lat: 48.8566, lon: 2.3522, country: '–§—Ä–∞–Ω—Ü–∏—è' },
                { name: '–ë–µ—Ä–ª–∏–Ω', lat: 52.5200, lon: 13.4050, country: '–ì–µ—Ä–º–∞–Ω–∏—è' },
                { name: '–°–∏–¥–Ω–µ–π', lat: -33.8688, lon: 151.2093, country: '–ê–≤—Å—Ç—Ä–∞–ª–∏—è' },
                { name: '–î—É–±–∞–π', lat: 25.2048, lon: 55.2708, country: '–û–ê–≠' }
            ];
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            async function getWeatherByCoords(lat, lon, cityName, country) {
                try {
                    const response = await fetch(
                        `${WEATHER_API}?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,relative_humidity_2m,wind_speed_10m&timezone=auto`
                    );
                    
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const data = await response.json();
                    const current = data.current_weather;
                    
                    // –ö–æ–¥—ã –ø–æ–≥–æ–¥—ã Open-Meteo
                    const weatherCodes = {
                        0: '–Ø—Å–Ω–æ ‚òÄÔ∏è', 1: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ üå§Ô∏è', 
                        2: '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å ‚õÖ', 3: '–ü–∞—Å–º—É—Ä–Ω–æ ‚òÅÔ∏è',
                        45: '–¢—É–º–∞–Ω üå´Ô∏è', 48: '–ò–∑–º–æ—Ä–æ–∑—å —Ç—É–º–∞–Ω–∞ ‚ùÑÔ∏è',
                        51: '–õ–µ–≥–∫–∞—è –º–æ—Ä–æ—Å—å üå¶Ô∏è', 53: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å üåßÔ∏è',
                        61: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å üåßÔ∏è', 63: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å üåßÔ∏è',
                        71: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥ ‚ùÑÔ∏è', 73: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥ ‚ùÑÔ∏è',
                        80: '–ù–µ–±–æ–ª—å—à–æ–π –ª–∏–≤–µ–Ω—å üåßÔ∏è', 95: '–ì—Ä–æ–∑–∞ ‚õàÔ∏è'
                    };
                    
                    const condition = weatherCodes[current.weathercode] || '–û–±–ª–∞—á–Ω–æ ‚òÅÔ∏è';
                    const temp = Math.round(current.temperature);
                    const wind = Math.round(current.windspeed);
                    const humidity = data.hourly?.relative_humidity_2m?.[0] || '–ù/–î';
                    
                    return {
                        city: cityName,
                        country: country,
                        temp: temp,
                        condition: condition,
                        wind: wind,
                        humidity: humidity,
                        feelsLike: Math.round(temp - wind * 0.2), // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—â—É—â–∞–µ–º–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
                        success: true
                    };
                    
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø–æ–≥–æ–¥—ã –¥–ª—è ${cityName}:`, error);
                    return {
                        city: cityName,
                        country: country,
                        temp: '–ù/–î',
                        condition: '–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
                        success: false
                    };
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
            function displayWeather(data) {
                container.innerHTML = '';
                
                if (!data || data.length === 0) {
                    container.innerHTML = `
                        <div class="search-info" style="grid-column: 1 / -1;">
                            üå§Ô∏è –î–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
                        </div>
                    `;
                    return;
                }
                
                data.forEach(weather => {
                    const tempColor = weather.temp === '–ù/–î' ? '#888' : 
                                    weather.temp > 25 ? '#ff3300' : 
                                    weather.temp > 15 ? '#ff9900' : 
                                    weather.temp > 5 ? '#00ff41' : 
                                    weather.temp > -5 ? '#0099ff' : '#9900ff';
                    
                    container.innerHTML += `
                        <div class="card weather-card" style="min-height: 180px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <div>
                                    <p class="pixel-label" style="margin: 0; font-size: 0.9rem;">
                                        ${weather.condition.split(' ').pop()} ${weather.city.toUpperCase()}
                                    </p>
                                    <p style="font-size: 0.8rem; color: var(--sub-text);">
                                        ${weather.country}
                                    </p>
                                </div>
                            </div>
                            
                            <div style="font-size: 2.5rem; font-weight: bold; color: ${tempColor}; margin: 10px 0;">
                                ${weather.temp}¬∞C
                            </div>
                            
                            ${weather.success ? `
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">
                                ${weather.condition}
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem; margin-top: 15px;">
                                <div>
                                    <div style="color: var(--sub-text);">üí® –í–µ—Ç–µ—Ä</div>
                                    <div>${weather.wind} –∫–º/—á</div>
                                </div>
                                <div>
                                    <div style="color: var(--sub-text);">üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                                    <div>${weather.humidity}%</div>
                                </div>
                                <div>
                                    <div style="color: var(--sub-text);">üå°Ô∏è –û—â—É—â–∞–µ—Ç—Å—è</div>
                                    <div>${weather.feelsLike}¬∞C</div>
                                </div>
                                <div>
                                    <div style="color: var(--sub-text);">üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ</div>
                                    <div>${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                                </div>
                            </div>
                            ` : `
                            <div style="color: var(--sub-text); margin-top: 20px;">
                                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
                            </div>
                            `}
                        </div>
                    `;
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            async function showPopularCities() {
                container.innerHTML = `
                    <div class="search-info" style="grid-column: 1 / -1;">
                        üå§Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã –¥–ª—è ${popularCities.length} –≥–æ—Ä–æ–¥–æ–≤...
                    </div>
                `;
                
                const weatherPromises = popularCities.map(city => 
                    getWeatherByCoords(city.lat, city.lon, city.name, city.country)
                );
                
                try {
                    const results = await Promise.all(weatherPromises);
                    displayWeather(results.filter(r => r.success).slice(0, 8));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã:', error);
                    container.innerHTML = `
                        <div class="search-info" style="grid-column: 1 / -1;">
                            ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.
                        </div>
                    `;
                }
            }
            
            // –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
            async function searchCity(query) {
                if (!query || query.trim().length < 2) {
                    await showPopularCities();
                    return;
                }
                
                container.innerHTML = `
                    <div class="search-info" style="grid-column: 1 / -1;">
                        üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ "${query}"...
                    </div>
                `;
                
                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–µ–æ–∫–æ–¥–∏–Ω–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                    const geoResponse = await fetch(
                        `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1&language=ru`
                    );
                    
                    const geoData = await geoResponse.json();
                    
                    if (!geoData.results || geoData.results.length === 0) {
                        container.innerHTML = `
                            <div class="search-info" style="grid-column: 1 / -1;">
                                üåç –ì–æ—Ä–æ–¥ "${query}" –Ω–µ –Ω–∞–π–¥–µ–Ω
                            </div>
                        `;
                        await showPopularCities();
                        return;
                    }
                    
                    const city = geoData.results[0];
                    const weather = await getWeatherByCoords(
                        city.latitude, 
                        city.longitude, 
                        city.name, 
                        city.country
                    );
                    
                    displayWeather([weather]);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞:', error);
                    container.innerHTML = `
                        <div class="search-info" style="grid-column: 1 / -1;">
                            üîç –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.
                        </div>
                    `;
                    await showPopularCities();
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.trim();
                searchCity(query);
            });
            
            // –§–∏–ª—å—Ç—Ä—ã –ø–æ–≥–æ–¥—ã
            document.querySelectorAll('.weather-filter-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    document.querySelectorAll('.weather-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    const query = searchInput.value.trim();
                    if (query) {
                        await searchCity(query);
                    } else {
                        await showPopularCities();
                    }
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            await showPopularCities();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            setInterval(async () => {
                if (!document.getElementById('weather').classList.contains('active')) return;
                
                const query = searchInput.value.trim();
                if (query) {
                    await searchCity(query);
                } else {
                    await showPopularCities();
                }
            }, 300000);
        }

        // --- –°–ï–ö–£–ù–î–û–ú–ï–† PRO (–ú–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –∏ –ö—Ä—É–≥–∏) ---
        const stopwatch = {
            timer: null, startTime: 0, elapsedTime: 0, running: false, lapCount: 0,
            display: document.getElementById('sw-display'),
            laps: document.getElementById('laps-list'),

            formatTime(ms) {
                let h = Math.floor(ms / 3600000).toString().padStart(2, '0');
                let m = Math.floor((ms % 3600000) / 60000).toString().padStart(2, '0');
                let s = Math.floor((ms % 60000) / 1000).toString().padStart(2, '0');
                let ms_f = Math.floor((ms % 1000) / 10).toString().padStart(2, '0');
                return `${h}:${m}:${s}.${ms_f}`;
            },
            
            update() {
                const now = Date.now();
                this.elapsedTime = now - this.startTime;
                this.display.innerText = this.formatTime(this.elapsedTime);
            },

            toggle() {
                if(this.running) {
                    clearInterval(this.timer);
                    this.running = false;
                    document.getElementById('sw-btn').innerText = "RESUME";
                } else {
                    this.startTime = Date.now() - this.elapsedTime;
                    this.timer = setInterval(() => this.update(), 10);
                    this.running = true;
                    document.getElementById('sw-btn').innerText = "STOP";
                }
            },
            
            lap() {
                if(this.running) {
                    this.lapCount++;
                    const lapTime = this.formatTime(this.elapsedTime);
                    this.laps.innerHTML += `<li>–ö—Ä—É–≥ ${this.lapCount}: <span>${lapTime}</span></li>`;
                    this.laps.scrollTop = this.laps.scrollHeight;
                }
            },

            reset() {
                clearInterval(this.timer);
                this.running = false;
                this.elapsedTime = 0;
                this.lapCount = 0;
                this.display.innerText = "00:00:00.00";
                document.getElementById('sw-btn').innerText = "START";
                this.laps.innerHTML = '';
            }
        };

        // --- –¢–ê–ô–ú–ï–† PRO (–î–Ω–∏, –ß–∞—Å—ã, –ú–∏–Ω—É—Ç—ã, –°–µ–∫—É–Ω–¥—ã) ---
        const timer = {
            timer: null, totalSeconds: 0, running: false,
            display: document.getElementById('tm-display'),

            formatTime(totalSecs) {
                const d = Math.floor(totalSecs / (3600 * 24));
                const h = Math.floor((totalSecs % (3600 * 24)) / 3600);
                const m = Math.floor((totalSecs % 3600) / 60);
                const s = Math.floor(totalSecs % 60);
                return `${d.toString().padStart(2,'0')}:${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            },

            start() {
                if(this.running) return;
                
                const d = parseInt(document.getElementById('tm-days').value) || 0;
                const h = parseInt(document.getElementById('tm-hours').value) || 0;
                const m = parseInt(document.getElementById('tm-mins').value) || 0;
                const s = parseInt(document.getElementById('tm-secs').value) || 0;
                
                this.totalSeconds = d * 86400 + h * 3600 + m * 60 + s;
                if(this.totalSeconds <= 0) return;

                document.getElementById('tm-btn').innerText = "–†–ê–ë–û–¢–ê–ï–¢...";
                this.running = true;
                
                this.timer = setInterval(() => {
                    this.totalSeconds--;
                    this.display.innerText = this.formatTime(this.totalSeconds);
                    if(this.totalSeconds <= 0) {
                        this.reset();
                        alert("–¢–ê–ô–ú–ï–† –ó–ê–í–ï–†–®–ï–ù!");
                    }
                }, 1000);
            },
            
            pause() {
                if(this.running) {
                    clearInterval(this.timer);
                    this.running = false;
                    document.getElementById('tm-btn').innerText = "RESUME";
                }
            },
            
            reset() {
                clearInterval(this.timer);
                this.running = false;
                this.totalSeconds = 0;
                this.display.innerText = "00:00:00:00";
                document.getElementById('tm-btn').innerText = "–°–¢–ê–†–¢";
            }
        };

        // --- –§–ò–ù–ê–ù–°–´ (–ê–ö–¶–ò–ò, –ö–†–ò–ü–¢–û, –°–´–†–¨–ï) ---
        async function fetchFinance() {
            const container = document.getElementById('rates-container');
            container.innerHTML = '<p class="pixel-label">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';

            // –ú–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ä–µ–∞–ª—å–Ω—ã–µ API)
            const financeData = [
                {
                    label: 'USD / RUB',
                    // –ü—É–±–ª–∏—á–Ω—ã–π API –¶–ë –†–§ (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫—É—Ä—Å)
                    url: 'https://www.cbr-xml-daily.ru/daily_json.js',
                    process: (data) => {
                        const rate = data.Valute.USD.Value.toFixed(2);
                        const prev = data.Valute.USD.Previous;
                        const change = ((rate - prev) / prev * 100).toFixed(2);
                        return {
                            value: `${rate} ‚ÇΩ`,
                            change: change,
                            isUp: change >= 0
                        };
                    },
                    color: '#00ff41'
                },
                {
                    label: 'EUR / RUB',
                    url: 'https://www.cbr-xml-daily.ru/daily_json.js',
                    process: (data) => {
                        const rate = data.Valute.EUR.Value.toFixed(2);
                        const prev = data.Valute.EUR.Previous;
                        const change = ((rate - prev) / prev * 100).toFixed(2);
                        return {
                            value: `${rate} ‚ÇΩ`,
                            change: change,
                            isUp: change >= 0
                        };
                    },
                    color: '#2ecc71'
                },
                {
                    label: 'BITCOIN / USD',
                    // –ü—É–±–ª–∏—á–Ω—ã–π API –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
                    url: 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true',
                    process: (data) => {
                        const rate = data.bitcoin.usd.toLocaleString('en-US', {maximumFractionDigits: 0});
                        const change = data.bitcoin.usd_24h_change.toFixed(1);
                        return {
                            value: `$${rate}`,
                            change: change,
                            isUp: change >= 0
                        };
                    },
                    color: '#f7931a'
                },
                {
                    label: 'GOLD (XAU)',
                    // –ó–∞–≥–ª—É—à–∫–∞ —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    url: null,
                    process: () => {
                        return {
                            value: '$2345.67',
                            change: '+0.8',
                            isUp: true
                        };
                    },
                    color: '#ffd700'
                }
            ];

            container.innerHTML = '';
            
            for (const item of financeData) {
                try {
                    let result;
                    if (item.url) {
                        const res = await fetch(item.url);
                        const data = await res.json();
                        result = item.process(data);
                    } else {
                        result = item.process();
                    }

                    container.innerHTML += `
                        <div class="card">
                            <p class="pixel-label">${item.label}</p>
                            <div class="rate-value" style="color:${item.color};">${result.value}</div>
                            <div class="rate-change ${result.isUp ? 'up' : 'down'}">
                                ${result.isUp ? '+' : ''}${result.change}%
                            </div>
                        </div>
                    `;
                } catch(e) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${item.label}:`, e);
                    // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                    container.innerHTML += `
                        <div class="card">
                            <p class="pixel-label">${item.label}</p>
                            <div class="rate-value" style="color:${item.color};">–ù/–î</div>
                            <div class="rate-change">‚Äî</div>
                        </div>
                    `;
                }
            }
        }
        fetchFinance();

        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú –ü–û–ò–°–ö–ê
        const originalSwitchTab = switchTab;
        switchTab = function(id) {
            originalSwitchTab(id);
            
            // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                switch(id) {
                    case 'clock':
                        if (window.globalSearch) {
                            const searchInput = document.getElementById('time-search');
                            if (searchInput && searchInput.value) {
                                window.globalSearch.searchQuery = searchInput.value;
                                window.globalSearch.updateTimeDisplay && window.globalSearch.updateTimeDisplay();
                            }
                        }
                        break;
                    case 'finance':
                        if (window.globalSearch) {
                            window.globalSearch.updateFinanceDisplay && window.globalSearch.updateFinanceDisplay();
                        }
                        break;
                    case 'weather':
                        if (window.globalSearch) {
                            window.globalSearch.updateWeatherDisplay && window.globalSearch.updateWeatherDisplay();
                        }
                        break;
                }
            }, 100);
        };

        // –ê–í–¢–û–§–û–ö–£–° –ù–ê –ü–û–ò–°–ö –ü–†–ò –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ò –í–ö–õ–ê–î–û–ö
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const target = item.dataset.target;
                setTimeout(() => {
                    let searchInput;
                    switch(target) {
                        case 'clock':
                            searchInput = document.getElementById('time-search');
                            break;
                        case 'finance':
                            searchInput = document.getElementById('finance-search');
                            break;
                        case 'weather':
                            searchInput = document.getElementById('weather-search');
                            break;
                    }
                    if (searchInput) {
                        searchInput.focus();
                    }
                }, 300);
            });
        });

        // –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò
        document.addEventListener('keydown', (e) => {
            // Ctrl+F –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                
                let searchInput;
                if (document.getElementById('clock').classList.contains('active')) {
                    searchInput = document.getElementById('time-search');
                } else if (document.getElementById('finance').classList.contains('active')) {
                    searchInput = document.getElementById('finance-search');
                } else if (document.getElementById('weather').classList.contains('active')) {
                    searchInput = document.getElementById('weather-search');
                }
                
                if (searchInput) {
                    searchInput.focus();
                    searchInput.select();
                }
            }
            
            // Escape –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
            if (e.key === 'Escape') {
                const activeInput = document.querySelector('input:focus');
                if (activeInput) {
                    activeInput.value = '';
                    activeInput.dispatchEvent(new Event('input'));
                }
            }
        });

        // --- –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –õ–û–ö–ê–¶–ò–ò (–ó–ê–ú–ï–ù–ê ipapi.co) ---
        async function getLocation() {
            const geoElement = document.getElementById('geo-city');
            if (!geoElement) return;
            
            try {
                // –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ API
                const apis = [
                    'https://ipinfo.io/json',
                    'https://geolocation-db.com/json/'
                ];
                
                let locationData = null;
                
                for (const api of apis) {
                    try {
                        const response = await fetch(api);
                        if (response.ok) {
                            locationData = await response.json();
                            break;
                        }
                    } catch (e) { /* –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π API */ }
                }
                
                if (locationData) {
                    geoElement.innerText = (locationData.city || locationData.country_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ').toUpperCase();
                } else {
                    // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—É—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(async (position) => {
                            try {
                                const response = await fetch(
                                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`
                                );
                                const data = await response.json();
                                geoElement.innerText = (data.address.city || data.address.country || '–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ').toUpperCase();
                            } catch (e) {
                                geoElement.innerText = '–û–ü–†–ï–î–ï–õ–ï–ù–û';
                            }
                        }, () => {
                            geoElement.innerText = '–û–ü–†–ï–î–ï–õ–ï–ù–û';
                        });
                    } else {
                        geoElement.innerText = '–û–ü–†–ï–î–ï–õ–ï–ù–û';
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏:', error);
                geoElement.innerText = '–û–ü–†–ï–î–ï–õ–ï–ù–û';
            }
        }

        // –í—ã–∑–æ–≤–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        getLocation();

        // --- –ü–û–ì–û–î–ê (Multi-City & Details) ---
        const weatherCities = ['Moscow', 'London', 'Tokyo', 'New York'];
        async function fetchWeather() {
            const container = document.getElementById('weather-container');
            container.innerHTML = '<p class="pixel-label">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã...</p>';

            // 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ IP)
            try {
                const geoRes = await fetch('https://ipapi.co/json/');
                const geoData = await geoRes.json();
                const city = geoData.city || '–ú–æ—Å–∫–≤–∞';
                document.getElementById('geo-city').innerText = city.toUpperCase();
            } catch(e) {
                document.getElementById('geo-city').innerText = '–ú–û–°–ö–í–ê';
            }

            // 2. –ü–æ–≥–æ–¥–∞ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º Open-Meteo API - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§)
            container.innerHTML = '';
            
            for (const city of weatherCities) {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–∞
                    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`);
                    const geoData = await geoRes.json();
                    
                    if (!geoData.results || geoData.results.length === 0) continue;
                    
                    const { latitude, longitude } = geoData.results[0];
                    
                    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–≥–æ–¥—É –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
                    const weatherRes = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`
                    );
                    const weatherData = await weatherRes.json();
                    
                    const current = weatherData.current_weather;
                    const temp = Math.round(current.temperature);
                    const wind = Math.round(current.windspeed);
                    const weatherCode = current.weathercode;
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–¥ –ø–æ–≥–æ–¥—ã –≤ —Ç–µ–∫—Å—Ç
                    const weatherDescriptions = {
                        0: '–Ø—Å–Ω–æ', 1: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ',
                        2: '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å', 3: '–ü–∞—Å–º—É—Ä–Ω–æ',
                        45: '–¢—É–º–∞–Ω', 48: '–ò–∑–º–æ—Ä–æ–∑—å',
                        51: '–õ–µ–∫–∞—è –º–æ—Ä–æ—Å—å', 53: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å',
                        55: '–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å', 56: '–õ–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å',
                        61: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å', 63: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å',
                        65: '–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å', 80: '–õ–∏–≤–µ–Ω—å'
                    };
                    
                    const desc = weatherDescriptions[weatherCode] || '–û–±–ª–∞—á–Ω–æ';

                    container.innerHTML += `
                        <div class="card">
                            <p class="pixel-label" style="margin-bottom: 5px;">${city.toUpperCase()}</p>
                            <div class="big-text small" style="margin: 0; color: var(--accent);">${temp}¬∞C</div>
                            <p>${desc}</p>
                            <p style="font-size: 0.8rem; margin-top: 10px;">
                                –í–µ—Ç–µ—Ä: ${wind} –∫–º/—á<br>
                                –®–∏—Ä–æ—Ç–∞: ${latitude.toFixed(1)}¬∞, –î–æ–ª–≥–æ—Ç–∞: ${longitude.toFixed(1)}¬∞
                            </p>
                        </div>
                    `;
                } catch(e) {
                    console.error(`–û—à–∏–±–∫–∞ –ø–æ–≥–æ–¥—ã –¥–ª—è ${city}:`, e);
                    // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                    container.innerHTML += `
                        <div class="card">
                            <p class="pixel-label" style="margin-bottom: 5px;">${city.toUpperCase()}</p>
                            <div class="big-text small" style="margin: 0; color: var(--accent);">–ù/–î</div>
                            <p>–î–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>
                        </div>
                    `;
                }
            }
        }
        fetchWeather();

        // –í–ö–õ–ê–î–ö–ê "–ú–ò–†–û–í–û–ï –í–†–ï–ú–Ø" - –° API
        async function setupTimeSearch() {
            const searchInput = document.getElementById('time-search');
            if (!searchInput) return;
            
            // API –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§ –±–µ–∑ CORS
            const TIMEZONES_API = 'https://worldtimeapi.org/api/timezone';
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
            let allTimezones = [];
            try {
                const response = await fetch(TIMEZONES_API);
                allTimezones = await response.json();
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allTimezones.length} —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤:', error);
                // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Ç–∞–π–º–∑–æ–Ω—ã
                allTimezones = Intl.supportedValuesOf('timeZone');
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            const timezoneData = allTimezones.map(tz => ({
                id: tz,
                city: tz.split('/').pop().replace(/_/g, ' '),
                region: tz.split('/')[0] || 'Global',
                searchText: tz.toLowerCase()
            }));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —Å—Ä–∞–∑—É
            const popularCities = ['Europe/Moscow', 'Europe/London', 'America/New_York', 
                                'Asia/Tokyo', 'Australia/Sydney', 'Asia/Dubai'];
            displayTimezones(timezoneData.filter(tz => popularCities.includes(tz.id)));
            
            // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
            searchInput.addEventListener('input', async (e) => {
                const query = e.target.value.toLowerCase();
                
                if (query.length < 2) {
                    displayTimezones(timezoneData.filter(tz => popularCities.includes(tz.id)));
                    return;
                }
                
                const filtered = timezoneData.filter(tz => 
                    tz.searchText.includes(query) ||
                    tz.city.toLowerCase().includes(query)
                );
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
                await displayTimezones(filtered.slice(0, 50), true);
            });
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
            async function displayTimezones(timezones, showLoading = false) {
                const container = document.getElementById('world-time-container');
                container.innerHTML = showLoading ? '<p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...</p>' : '';
                
                for (const tz of timezones.slice(0, 30)) {
                    try {
                        // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
                        const timeResponse = await fetch(`https://worldtimeapi.org/api/timezone/${tz.id}`);
                        const timeData = await timeResponse.json();
                        
                        const time = new Date(timeData.datetime).toLocaleTimeString('ru-RU', {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        
                        container.innerHTML += `
                            <div class="card time-card">
                                <p class="pixel-label">${tz.city.toUpperCase()}</p>
                                <div class="big-text small" style="color: var(--accent);">${time}</div>
                                <p style="font-size: 0.7rem; color: var(--sub-text);">
                                    ${tz.region} ‚Ä¢ UTC${timeData.utc_offset}
                                </p>
                            </div>
                        `;
                    } catch (error) {
                        // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
                        const time = new Date().toLocaleTimeString('ru-RU', {
                            timeZone: tz.id,
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        container.innerHTML += `
                            <div class="card time-card">
                                <p class="pixel-label">${tz.city.toUpperCase()}</p>
                                <div class="big-text small" style="color: var(--accent);">${time}</div>
                                <p style="font-size: 0.7rem; color: var(--sub-text);">${tz.region}</p>
                            </div>
                        `;
                    }
                }
            }
        }

        // –í–ö–õ–ê–î–ö–ê "–§–ò–ù–ê–ù–°–´" - –° API
        async function setupFinanceSearch() {
            const searchInput = document.getElementById('finance-search');
            if (!searchInput) return;
            
            // API –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –†–§
            const APIs = {
                // –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫–ª—é—á–∞)
                crypto: 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100',
                // –í–∞–ª—é—Ç—ã (–¶–ë –†–§)
                forex: 'https://www.cbr-xml-daily.ru/daily_json.js',
                // –°—ã—Ä—å–µ (fallback API)
                commodity: null
            };
            
            let financeData = [];
            let loaded = false;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
            async function loadFinanceData() {
                if (loaded) return;
                
                try {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
                    const cryptoRes = await fetch(APIs.crypto);
                    const cryptoData = await cryptoRes.json();
                    
                    cryptoData.slice(0, 20).forEach(crypto => {
                        financeData.push({
                            symbol: crypto.symbol.toUpperCase(),
                            name: crypto.name,
                            type: 'crypto',
                            price: `$${crypto.current_price.toLocaleString()}`,
                            change: crypto.price_change_percentage_24h.toFixed(2),
                            isUp: crypto.price_change_percentage_24h >= 0,
                            color: crypto.symbol === 'btc' ? '#f7931a' : '#627eea'
                        });
                    });
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞–ª—é—Ç—ã
                    const forexRes = await fetch(APIs.forex);
                    const forexData = await forexRes.json();
                    
                    Object.values(forexData.Valute).slice(0, 10).forEach(currency => {
                        financeData.push({
                            symbol: currency.CharCode,
                            name: currency.Name,
                            type: 'forex',
                            price: `${currency.Value.toFixed(2)} ‚ÇΩ`,
                            change: ((currency.Value - currency.Previous) / currency.Previous * 100).toFixed(2),
                            isUp: currency.Value >= currency.Previous,
                            color: currency.CharCode === 'USD' ? '#00ff41' : '#0033cc'
                        });
                    });
                    
                    loaded = true;
                    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤:', financeData.length);
                    updateFinanceDisplay();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                    // Fallback –¥–∞–Ω–Ω—ã–µ
                    financeData = getFallbackFinanceData();
                    updateFinanceDisplay();
                }
            }
            
            // –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            searchInput.addEventListener('input', (e) => {
                updateFinanceDisplay(e.target.value.toLowerCase());
            });
            
            // –§–∏–ª—å—Ç—Ä—ã
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    window.currentFinanceFilter = this.dataset.filter;
                    updateFinanceDisplay(searchInput.value);
                });
            });
            
            function updateFinanceDisplay(query = '') {
                if (!loaded && query.length === 0) {
                    loadFinanceData();
                    return;
                }
                
                let filtered = financeData;
                
                if (window.currentFinanceFilter && window.currentFinanceFilter !== 'all') {
                    filtered = filtered.filter(item => item.type === window.currentFinanceFilter);
                }
                
                if (query) {
                    filtered = filtered.filter(item => 
                        item.symbol.toLowerCase().includes(query) ||
                        item.name.toLowerCase().includes(query)
                    );
                }
                
                displayFinanceData(filtered.slice(0, 50));
            }
            
            function displayFinanceData(data) {
                const container = document.getElementById('rates-container');
                if (!container) return;
                
                container.innerHTML = '';
                
                data.forEach(item => {
                    container.innerHTML += `
                        <div class="card rate-card">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="pixel-label">${item.symbol}</span>
                                <span style="font-size: 0.7rem; background: var(--panel-bg); padding: 2px 6px; border-radius: 3px;">
                                    ${item.type === 'crypto' ? '–ö–†–ò–ü–¢–û' : '–í–ê–õ–Æ–¢–ê'}
                                </span>
                            </div>
                            <div style="font-size: 1.8rem; color: ${item.color}; margin: 10px 0; font-weight: bold;">
                                ${item.price}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--sub-text);">${item.name}</div>
                            <div class="rate-change ${item.isUp ? 'up' : 'down'}" style="margin-top: 10px;">
                                ${item.isUp ? '‚Üó' : '‚Üò'} ${Math.abs(item.change)}%
                            </div>
                        </div>
                    `;
                });
                
                if (data.length === 0) {
                    container.innerHTML = `<div class="search-info">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadFinanceData();
        }

        // –í–ö–õ–ê–î–ö–ê "–ü–û–ì–û–î–ê" - –° API
        async function setupWeatherSearch() {
            const searchInput = document.getElementById('weather-search');
            if (!searchInput) return;
            
            // API –ø–æ–≥–æ–¥—ã (wttr.in —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§)
            const WEATHER_API = 'https://wttr.in/';
            
            // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
            const popularCities = ['Moscow', 'London', 'Tokyo', 'New_York', 'Paris', 'Berlin'];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —Å—Ä–∞–∑—É
            await displayWeatherForCities(popularCities);
            
            // –ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥–∞–º
            searchInput.addEventListener('input', async (e) => {
                const query = e.target.value.trim();
                
                if (query.length < 2) {
                    await displayWeatherForCities(popularCities);
                    return;
                }
                
                try {
                    // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –≥–æ—Ä–æ–¥
                    const response = await fetch(`${WEATHER_API}${query}?format=j1`);
                    const data = await response.json();
                    
                    if (data.current_condition) {
                        displayWeatherForCity(query, data);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ–≥–æ–¥—ã:', error);
                    document.getElementById('weather-container').innerHTML = `
                        <div class="search-info">
                            –ì–æ—Ä–æ–¥ "${query}" –Ω–µ –Ω–∞–π–¥–µ–Ω
                        </div>
                    `;
                }
            });
            
            // –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø—É –ø–æ–≥–æ–¥—ã
            document.querySelectorAll('.weather-filter-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    document.querySelectorAll('.weather-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.dataset.weatherFilter;
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –∫ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
                    const container = document.getElementById('weather-container');
                    const cards = container.querySelectorAll('.weather-card');
                    
                    cards.forEach(card => {
                        const weatherType = card.dataset.weatherType;
                        card.style.display = (filter === 'all' || weatherType === filter) ? 'block' : 'none';
                    });
                });
            });
            
            async function displayWeatherForCities(cities) {
                const container = document.getElementById('weather-container');
                container.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã...</p>';
                
                let html = '';
                
                for (const city of cities) {
                    try {
                        const response = await fetch(`${WEATHER_API}${city}?format=j1`);
                        const data = await response.json();
                        
                        if (data.current_condition) {
                            html += createWeatherCard(city, data);
                        }
                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –ø–æ–≥–æ–¥—ã –¥–ª—è ${city}:`, error);
                    }
                }
                
                container.innerHTML = html || '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É</p>';
            }
            
            function displayWeatherForCity(cityName, data) {
                const container = document.getElementById('weather-container');
                container.innerHTML = createWeatherCard(cityName, data);
            }
            
            function createWeatherCard(cityName, data) {
                const current = data.current_condition[0];
                const temp = current.temp_C;
                const condition = current.weatherDesc[0].value;
                const humidity = current.humidity;
                const wind = current.windspeedKmph;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ–≥–æ–¥—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
                let weatherType = 'cloudy';
                if (condition.toLowerCase().includes('sun') || condition.toLowerCase().includes('clear')) weatherType = 'sunny';
                if (condition.toLowerCase().includes('rain')) weatherType = 'rainy';
                if (condition.toLowerCase().includes('snow')) weatherType = 'snowy';
                if (condition.toLowerCase().includes('storm') || condition.toLowerCase().includes('thunder')) weatherType = 'stormy';
                
                // –¶–≤–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
                const tempColor = temp > 25 ? '#ff3300' : 
                                temp > 15 ? '#ff9900' : 
                                temp > 5 ? '#00ff41' : 
                                temp > -5 ? '#0099ff' : '#9900ff';
                
                return `
                    <div class="card weather-card" data-weather-type="${weatherType}">
                        <p class="pixel-label">${cityName.replace('_', ' ').toUpperCase()}</p>
                        <div style="font-size: 2.5rem; color: ${tempColor}; font-weight: bold; margin: 10px 0;">
                            ${temp}¬∞C
                        </div>
                        <div style="font-size: 1rem; margin-bottom: 10px;">${condition}</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                            <div>
                                <div style="color: var(--sub-text);">üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                                <div>${humidity}%</div>
                            </div>
                            <div>
                                <div style="color: var(--sub-text);">üí® –í–µ—Ç–µ—Ä</div>
                                <div>${wind} –∫–º/—á</div>
                            </div>
                            <div>
                                <div style="color: var(--sub-text);">üå°Ô∏è –û—â—É—â–∞–µ—Ç—Å—è</div>
                                <div>${current.FeelsLikeC}¬∞C</div>
                            </div>
                            <div>
                                <div style="color: var(--sub-text);">üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å</div>
                                <div>${current.visibility} –∫–º</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; font-size: 0.8rem; color: var(--sub-text);">
                            –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU')}
                        </div>
                    </div>
                `;
            }
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–°–ï–ì–û –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ó–∞–ø—É—Å–∫ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
            const originalSwitchTab = switchTab;
            switchTab = function(tabId) {
                originalSwitchTab(tabId);
                
                setTimeout(() => {
                    switch(tabId) {
                        case 'clock':
                            setupTimeSearch();
                            break;
                        case 'finance':
                            setupFinanceSearch();
                            break;
                        case 'weather':
                            setupWeatherSearch();
                            break;
                    }
                }, 100);
            };
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
            if (document.getElementById('clock').classList.contains('active')) {
                setupTimeSearch();
            }
        });

        function getFallbackFinanceData() {
            return [
                {symbol: 'BTC', name: 'Bitcoin', type: 'crypto', price: '$68,450', change: '+2.3%', isUp: true, color: '#f7931a'},
                {symbol: 'ETH', name: 'Ethereum', type: 'crypto', price: '$3,520', change: '+1.8%', isUp: true, color: '#627eea'},
                {symbol: 'USD', name: '–î–æ–ª–ª–∞—Ä –°–®–ê', type: 'forex', price: '92.45 ‚ÇΩ', change: '+0.2%', isUp: true, color: '#00ff41'},
                {symbol: 'EUR', name: '–ï–≤—Ä–æ', type: 'forex', price: '99.80 ‚ÇΩ', change: '-0.1%', isUp: false, color: '#0033cc'},
                {symbol: 'GAZP', name: '–ì–∞–∑–ø—Ä–æ–º', type: 'stock', price: '198.50 ‚ÇΩ', change: '+0.8%', isUp: true, color: '#00a550'},
                {symbol: 'SBER', name: '–°–±–µ—Ä–±–∞–Ω–∫', type: 'stock', price: '325.20 ‚ÇΩ', change: '+1.2%', isUp: true, color: '#48b85b'},
                {symbol: 'XAU', name: '–ó–æ–ª–æ—Ç–æ', type: 'commodity', price: '$2,345', change: '+0.7%', isUp: true, color: '#ffd700'},
                {symbol: 'BRENT', name: '–ù–µ—Ñ—Ç—å Brent', type: 'commodity', price: '$82.30', change: '-1.5%', isUp: false, color: '#000000'}
            ];
        }
        
        // --- –ù–û–í–û–°–¢–ò (Public RSS Proxy) ---
        async function fetchNews() {
            const container = document.getElementById('news-feed');
            container.innerHTML = '<p class="pixel-label">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</p>';
            
            // –†–æ—Å—Å–∏–π—Å–∫–∏–µ RSS-–ª–µ–Ω—Ç—ã (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É)
            const rssFeeds = [
                'https://lenta.ru/rss/news',          // –õ–µ–Ω—Ç–∞.—Ä—É
                // 'https://www.vedomosti.ru/rss/news',  // –í–µ–¥–æ–º–æ—Å—Ç–∏
                // 'https://ria.ru/export/rss2/archive/index.xml' // –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏
            ];
            
            const selectedFeed = rssFeeds[0]; // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä
            
            try {
                const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(selectedFeed)}`;
                const res = await fetch(proxyUrl);
                
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();

                if (data.items && data.items.length > 0) {
                    container.innerHTML = '';
                    data.items.slice(0, 8).forEach(item => {
                        const date = new Date(item.pubDate);
                        const timeStr = date.toLocaleTimeString('ru-RU', { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        
                        container.innerHTML += `
                            <div class="card" style="margin-bottom: 10px;">
                                <p class="pixel-label" style="color: var(--accent); margin-bottom: 5px; font-size: 0.8rem;">
                                    ${item.title.toUpperCase()}
                                </p>
                                <p style="font-size: 0.8rem; color: var(--sub-text); margin-bottom: 8px;">
                                    üìÖ ${date.toLocaleDateString('ru-RU')} üïê ${timeStr}
                                </p>
                                <p style="font-size: 0.9rem; margin-bottom: 8px;">${item.description.substring(0, 120)}...</p>
                                <a href="${item.link}" target="_blank" 
                                style="color: var(--accent); text-decoration: none; font-size: 0.8rem; border: 1px solid var(--accent); padding: 3px 8px; display: inline-block;">
                                    üìñ –ß–ò–¢–ê–¢–¨
                                </a>
                            </div>
                        `;
                    });
                } else {
                    container.innerHTML = '<p class="pixel-label" style="text-align: center; padding: 20px;">–ù–û–í–û–°–¢–ò –ù–ï –ù–ê–ô–î–ï–ù–´</p>';
                }
            } catch(e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π:', e);
                container.innerHTML = `
                    <div class="card">
                        <p class="pixel-label" style="text-align: center;">–û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò –ù–û–í–û–°–¢–ï–ô</p>
                        <p style="font-size: 0.9rem; text-align: center; margin-top: 10px;">
                            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
                        </p>
                    </div>
                `;
            }
        }
        fetchNews();

        // --- –ú–£–ó–´–ö–ê–õ–¨–ù–´–ô –ü–õ–ï–ï–† ---
        const audioPlayer = {
            el: document.getElementById('bg-audio'),
            playing: false,
            toggle() {
                const bars = document.querySelectorAll('.bar');
                if(!this.playing) {
                    this.el.play();
                    bars.forEach((b, i) => b.style.animationDelay = `${i * 0.1}s`);
                    bars.forEach(b => b.style.display = 'block');
                } else {
                    this.el.pause();
                    bars.forEach(b => b.style.display = 'none');
                }
                this.playing = !this.playing;
                document.getElementById('t-music').innerText = this.playing ? "STOP MUSIC" : "PLAY MUSIC";
            }
        };

        function toggleTheme() {
            document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark';
        }

        // –î–û–ë–ê–í–¨ –í –ö–û–ù–ï–¶ –°–í–û–ï–ì–û –°–ö–†–ò–ü–¢–ê:
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
            const originalSwitchTab = switchTab;
            switchTab = function(tabId) {
                originalSwitchTab(tabId);
                
                setTimeout(() => {
                    switch(tabId) {
                        case 'clock':
                            setupTimeSearch();
                            break;
                        case 'finance':
                            setupFinanceSearch();
                            break;
                        case 'weather':
                            setupWeatherSearch();
                            break;
                    }
                }, 100);
            };
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
            if (document.getElementById('clock').classList.contains('active')) {
                setupTimeSearch();
            }
        });
    </script>
</body>

</html>
